# 自动化量化分析与闭环自演进选股引擎 (A-Share Quant System)

这是一个基于数据驱动、历史回测回馈以及机器自适应学习的 A 股现代化量化分析与自动化决策平台。整个系统核心逻辑已实现了：数据清洗同步 -> 海量图谱指标推演 -> 精确切入点锁定 -> 历史盘面胜率回溯 -> 机器自我进化调整指标（全栈递归闭环优化机制）。

## 核心设计宗旨与实现逻辑 (Core Principles)

区别于仅能提供几条均线的普通选股器，本系统的设计重点落在 **“精准捕捉”** 与 **“自适应迭代进化 (Recursive Automated Optimization)”** 两个层面：

1. **多重安全护城河机制 (`stock_filter.py`)**：在量化计算前，强行将 `< 50亿` 的微盘股、 `< 1000 万` 成交量僵尸股、大于 `20%` 异常换手率的疑似庄股强行拦截抛弃。
2. **多重因子动态综合交汇 (`analyzer.py`)**: 将 MA趋势排列 + MACD底部背离动能 + RSI极限反转点 + OBV资金接力强度，形成四面合围的因子总分漏斗模型。
3. **“见血封喉”的精确买入引擎 (`backtester.py - scan_today_signal`)**: 在多因子初选的高分标底池中，引擎如显微镜般再次扫雷，**仅输出**彻底满足苛刻条件（长均线健康 + 急跌极度缩量回踩 + 出现企稳信号）的唯一指定战利品。
4. **回溯推演与自我进化 (`optimizer.py`)**: （**系统的最强武器**）依托 `Walk-Forward` 滚动回测与 `Hill Climbing` 启发式机器变异算法，系统通过不间断自我演练数十万个模拟仓，寻觅出在当前市场情绪下（例如此时需要拉长MA周期还是调低RSI阀门）能获取最强“夏普比值胜率”的金枪参数，并一键写回 `config.yaml` 无缝支持到次日的开盘扫靶当中，**形成了一套永不停摆的自我递归矫正的自动化武器库。**

---

## 环境与部署 (Installation)

由于量化计算要求环境隔离高度干净统一，推荐直接使用现代包管器 `uv`（也可以采用常规 `pip` 安装）。
```bash
uv sync 
# 或者手动执行: uv add baostock pandas requests pyyaml pandas-ta tqdm gradio pyecharts backtesting
```

---

## 🚀 日常工作流：如何获取最新“见血封喉”精标？(Daily Workflow)

本工程提供了极具好感度的高性能 Web 可视化驾驶屏，极大简化了传统控制台敲击代码执行日常数据分析链路。每日收盘（15:00）后，打开控制台输入：
```bash
uv run python main.py ui
```
随即打开浏览器 `http://127.0.0.1:7860`。按照页面上的数字序号流程执行：

**第 1 步：底层供电与粮草储备（Tab 1: 数据同步与底仓构建）**
- 点击 `拉取/清洗最新有效股票池`，系统剔除僵尸与微盘退市风险标。
- 点击 `增量更新所有股票历史 K 线`，只对断点日期缺口自动补充最新日K线数据，极速不折腾。

**第 2 步：战略锁定与点名开火（Tab 2: 核心策略打分与精准买点扫描）**
- 点击 `运行全市场多因子综合评级`，多进程并发下秒级算出大盘当前潜能靠前的底牌。
- 点击 `精确扫描今日买点标的`，**此结果即为您明日可重点建仓标的列表。** 它将滤除只是“看起来不错”的票，仅在确认符合（缩量极致回踩 / 超卖企稳乖离金叉）双核逻辑并拥有足够高获胜回测机率的猎物前，闪红警报。这里给出的标的绝对不是泛泛海推，而是完全触发苛刻扣机线的票。

**第 3 步：战前盘面沙盒复盘验证（Tab 3: 历史胜率回测与沙盘推演 - 可选）**
- 针对步骤 2 给出的标的，在文本框填入代码（例如 `sh.600000`），系统立刻为您构建最近 1-3 年的交易演练 K 视图。不仅统计总净值与最大跌坑率，还会将上百笔“买点”“卖点”如落子般直观砸在波浪图表之上。您可以凭该验证来决定次日下单的信心比重。

---

## 🧬 第 4 维度：量化灵魂自我调优器 (Auto-Optimizer Tab 4)

如果市场风格（如从大行情的波段牛切换进极致的缩量猴市震荡），过去的固定指标（例如传统 MACD 12/26 或者 MA 30）将完全失灵。这就是本平台 **Tab 4 自动递归进化模块** 发挥战略威力的所在之处。

**如何开启自我进化？**
1. 定期（如每周末或市场风格显著切换时），切入至该选项卡。
2. 拖拽设定好最大可承受的爬山学习算力（建议普通电脑设定为轮数：5，每次抓取池：200；对于服务器托管环境可大幅调高）。目标选择：`sharpe_adj`（夏普比率加权收益，同时考量回撤风险的黄金分）。
3. 点击 `立即启动参数自我进化引擎`，去泡杯咖啡。
4. 系统将在后台模拟成百上千条平行宇宙的时空线：更改指标周期、修改入场判断严苛度、改变停利退场线阈值——直到找到一组压倒一切历史表现的新生代规则体系。
5. **最关键一跃：演进完成的这批最高效参数，将被自闭环物理固化于核心的 `config.yaml` 当中**。意味着您次日再执行前述的【日常工作流】时，您的选股底牌引擎已经被悄无声息的替换为了这副最锋利的新世代核心参数。

---

## 💻 命令行守护神（Crontab/CI 无人值守流）

如果需要彻底实现无人在场的自动流水线，本系统提供纯终端黑盒链：
```bash
# 收盘后更新环境
uv run python main.py update-list
uv run python main.py update-data

# 并行分析当日的底层标的打分
uv run python main.py analyze

# 如有需要，直接在服务器算力上抛开UI界面进行疯狂演练自动覆写进化
uv run python main.py optimize --rounds 10 --samples 300
```
